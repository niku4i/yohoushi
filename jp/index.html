<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="../stylesheets/jp-stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="../stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="../stylesheets/print.css" media="print" />
    <link rel="stylesheet" type="text/css" href="../stylesheets/yohoushi.css" media="screen" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Yohoushi - for allusers who love graphs!</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Yohoushi</h1>
        <h2>Yohoushi loves GrowthForecast</h2>
        <a href="https://github.com/yohoushi/yohoushi" class="button"><small>View project on</small>GitHub</a>
        <div class="language">
          <button onclick='location.href="../"' class="lang-button not-selected">English</button>
          <button class="lang-button selected">Japanese</button>
        </div>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
        
<h2>About Yohoushi
<a name="welcome-to-yohoushi" class="anchor" href="#welcome-to-yohoushi"><span class="octicon octicon-link">&dagger;</span></a></h2>

<p>Yohoushi は <a href="http://kazeburo.github.io/GrowthForecast/">GrowthForecast</a> と連携し動作するグラフツールです。GrowthForecastをバックエンドとして利用し、Yohoushi は統合グラフビューワとして機能します。</p>

<p>Yohoushi では GrowthForecast では実現できなかった様々なビューでグラフを確認できます。例えば、グラフを大きくしたり、from/toの日時指定でグラフを確認したり、サムネイルサイズでたくさんあるグラフを一覧で見たりすることできます。またGrowthForecastではグラフ階層が3階層固定でしたがYohoushiではこの制約を無くすことも可能です。</p>

<p>また複数のGrowthForecastを集約してユーザに見せることが可能です。GrowthForecastサーバの台数を増やすことでシステムを容易にスケールできるようになります。また、たとえば各拠点に散らばっていたGrowthForecastサーバを1つのビューで見せることも可能です。</p>

<pre><code>         +----------+                 +---+
         |          |            +--> |GF1| <--- post a number 
Ops ---> | Yohoushi | <----------+    +---+
         |          |            |    +---+
         +----------+            +--> |GF2| <--- post a number
                                      +---+
</code></pre>

<p>また、既存のGrowthForecastのシステムに変更を加えることなくYohoushiをお試しできます。この場合は、たとえばcronなどで動作しているGrowthForecastへ値を登録するスクリプトを変更する必要はありません。動作イメージを短時間で把握するには<a href="../screencasts/">こちらのスクリーンキャスト</a>がお勧めです。</p>

<h2>Installation
<a name="instalation" class="anchor" href="#installation"><span class="octicon octicon-link">&dagger;</span></a></h2>

<h3>(1) Requirements
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link">&dagger;</span></a></h3>

<p>あらかじめ以下のソフトウェアをインストールしておいてください。</p>
<ol>
  <li>Ruby (>=2.0.0)</li>
  <li>MySQL or Sqlite3 (>=3.6.16)</li>
  <li><a href="http://kazeburo.github.io/GrowthForecast/">GrowthForecast</a> (>=0.62)</li>
</ol>

<h3>(2) Install Yohoushi
<a name="install-yohoushi" class="anchor" href="#install-yohoushi"><span class="octicon octicon-link">&dagger;</span></a></h3>

<p><a href="https://github.com/yohoushi/yohoushi/releases">yohoushi/releases</a> からアーカイブファイルをダウンロード、展開し、youhoushi ディレクトリで以下のコマンドを実行してください。
数分かかることがあります。 </p>

<pre><code>$ bin/bundle
</code></pre>

<h3>(3) Configure Application
<a name="configure-applicaiton" class="anchor" href="#configure-applicaiton"><span class="octicon octicon-link">&dagger;</span></a></h3>

<p>GrowthForecast サーバのURLを config/application.yml に登録してください。
デフォルトでは localhost:5125 の GrowthForecast サーバに接続します。</p>

<pre><code># config/application.yml
multiforecast:
  mapping:
    '':     'http://localhost:5125'
</code></pre>

<p>複数の GrowthForecast サーバへ分散させる場合は以下のようにマッピングルールを記述します。</p>

<pre><code># config/application.yml
multiforecast:
  mapping:
    'app1/':     'http://host.to.growthforecast1:5125'
    'app2/':     'http://host.to.growthforecast2:5125'
</code></pre>

<p>この例では、名前が app1/ から始まるグラフは host.to.growthforecast1:5125 に、app2/ から始まるグラフは host.to.growthforecast2:5125 に分散されます。</p>

<h3>(4) Configure Database
<a name="configure-database" class="anchor" href="#configure-database"><span class="octicon octicon-link">&dagger;</span></a></h3>

<p>config/database.yml にMySQLの設定を記述し、次のコマンドを実行してください。</p>

<pre><code>$ bin/rake db:create db:migrate
</code></pre>

<p>デフォルトでは localhost:3306 の MySQL に root ユーザ、パスワードなしで接続し、yohoushi という名前のデータベースを作成します。</p>

<pre><code># config/database.yml
  adapter: mysql2
  database: yohoushi
  pool: 5
  timeout: 5000
  username: root
  password: 
  host: localhost
  port: 3306
</code></pre>

<h4>Support SQLite
<a name="configure-database" class="anchor" href="#support-sqlite"><span class="octicon octicon-link">&dagger;</span></a></h4>

<p>MySQLではなくSQLiteを使いたい場合は以下を実行してください。</p>

<p>Gemfileを修正してください。</p>

<pre><code># Gemfile
gem 'sqlite3'  # 行頭の#を削除する
# gem 'mysql2' # コメントアウトする
</code></pre>

<p>次のコマンドを実行してください。</p>

<pre><code>$ cp config/database-sqlite.yml config/database.yml
$ bin/bundle
$ bin/rake db:create db:migrate
</code></pre>

<h3>(5) Run
<a name="run" class="anchor" href="#run"><span class="octicon octicon-link">&dagger;</span></a></h3>

<p>以下のコマンドで Yohoushi が起動します。</p>

<pre><code>$ bin/yohoushi</code></pre>

<p>ウェブブラウザで<code>http://localhost:4804</code>にアクセスしてみてください！Yohoushiの画面を確認できます。</p>

<p>デーモン化するには <code>-d</code> オプションを付けて起動してください。</p>

<pre><code>$ bin/yohoushi -d</code></pre>

<p>デーモン化したYohoushiを停止するには以下を実行してください。</p>

<pre><code>$ bin/yohoushi stop</code></pre>

<h3>(6) Check
<a name="check" class="anchor" href="#check"><span class="octicon octicon-link">&dagger;</span></a></h3>

<p>Yohoushi の動作確認をするために GrowthForecast の URLに対してPOST リクエストを送り、グラフを作成してみましょう。この例では GrowthForecast が localhost:5125 で起動しているものとします。</p>

<pre><code>$ curl -d 'number=10' http://localhost:5125/api/service1/section1/graph1
</code></pre>

<p>Yohoushi worker の GrowthForecast との同期処理が走って(最大１分待ちます) Yohoushi にグラフが表示されれば成功です。</p>

<h2>For more information
<a name="for-more-infomation" class="anchor" href="#for-more-information"><span class="octicon octicon-link">&dagger;</span></a></h2>

<p>Yohoushiに4階層以上のグラフを登録するには Yohoushi API か <a href="https://github.com/sonots/multiforecast-client">multiforecast-client</a> を使ってデータをPOSTしてください。</p>

<p>Yohoushi API には次のようにデータを POST します。mapping ルールに従って、適切な GrowthForecast に分散してくれます。</p>

<pre><code>$ curl -d 'number=10' http://yohoushi:4804/api/graphs/sec1/sec2/sec3/graph1
</code></pre>

<p>ただし、Yohoushi API を多用すると Yohoushi がボトルネックになる可能性があるため、mapping ルールに従って直接 GrowthForecast にデータを POST してくれる
<a href="https://github.com/sonots/multiforecast-client">multiforecast-client</a> の使用を推奨します。</p>

        </section>

        <aside id="sidebar">
          <a href="https://github.com/yohoushi/yohoushi/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/yohoushi/yohoushi/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/yohoushi/yohoushi"></a> is maintained by <a href="https://github.com/yohoushi">yohoushi</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
